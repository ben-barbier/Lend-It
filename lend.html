<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Lend-It</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    <!-- Le styles -->
    <link href="lib/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <style type="text/css">
      body {
        padding-top: 60px;
        padding-bottom: 40px;
      }
      .sidebar-nav {
        padding: 9px 0;
      }
      .form-horizontal .control-label{
        width: 60px;
      }
      .form-horizontal .controls {
        margin-left: 80px;
      }
    </style>
    <link href="lib/bootstrap/css/bootstrap-responsive.min.css" rel="stylesheet">
    <link href="lib/datepicker/css/datepicker.css" rel="stylesheet"> 

    <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le fav and touch icons -->
<!--     <link rel="shortcut icon" href="bootstrap/ico/favicon.ico"> -->
<!--     <link rel="apple-touch-icon-precomposed" sizes="144x144" href="lib/bootstrap/ico/apple-touch-icon-144-precomposed.png"> -->
<!--     <link rel="apple-touch-icon-precomposed" sizes="114x114" href="lib/bootstrap/ico/apple-touch-icon-114-precomposed.png"> -->
<!--     <link rel="apple-touch-icon-precomposed" sizes="72x72" href="lib/bootstrap/ico/apple-touch-icon-72-precomposed.png"> -->
<!--     <link rel="apple-touch-icon-precomposed" href="lib/bootstrap/ico/apple-touch-icon-57-precomposed.png"> -->
  </head>

  <body>
    
    <div id="header"></div>
    
    <div class="container">
      
      <h1>Lend !</h1>
      
      <div class="row">
        <div class="span4"> 
          <div class="well">
            <form class="form-horizontal" action="#">
              <legend>Record a lend</legend>
              <div class="control-group">
                <label class="control-label" for="inputWhat">What :</label>
                <div class="controls">
                  <input type="text" id="inputWhat" placeholder="What have you lent ?">
                </div>
                </div>
                <div class="control-group">
                  <label class="control-label" for="inputWho">Who :</label>
                  <div class="controls">
                    <input type="text" id="inputWho" placeholder="To whom you have lent ?">
                  </div>
                </div>
                <div class="control-group">
                  <label class="control-label" for="inputWhen">When :</label>
                  <div class="controls">
                    <div data-date-viewmode="years" data-date-format="dd/mm/yyyy" data-date="12/02/2012" id="inputWhen" class="datepicker input-append date">
                      <input type="text" readonly="" value="12/02/2012" size="16" class="span2" />
                      <span class="add-on"><i class="icon-calendar"></i></span>
                    </div>
                  </div>
                </div>
                 <br />
                <button type="submit" id="addLendButton" class="btn btn-primary">Add lend</button>
            </form>
          </div>
        </div>
        <div class="span8">
          
          <!-- Alerts -->
          <div id="addLendSuccess" class="alert alert-success hide">
            <button type="button" class="close" data-dismiss="alert">×</button>
            Lend successfully saved.
          </div>
          <div id="editLendSuccess" class="alert alert-success hide">
            <button type="button" class="close" data-dismiss="alert">×</button>
            Lend successfully updated.
          </div>
          <div id="deleteLendSuccess" class="alert alert-success hide">
            <button type="button" class="close" data-dismiss="alert">×</button>
            Lend successfully deleted.
          </div>
          <!-- /Alerts -->
          
          <table class="table table-hover table-condensed">
            <thead>
              <tr>
                <th>#</th>
                <th>What</th>
                <th>Who</th>
                <th>When</th>
                <th></th>
                <th></th>
              </tr>
            </thead>
            <tbody id="lendList"> 
              <script id="LendListTable" type="text/template">
              {{#lendList}}
                <tr>
                  <td>{{lendId}}</td>
                  <td>{{object}}</td>
                  <td>{{who}}</td>
                  <td>{{when}}</td>
                  <td><i class="icon-pencil" id="editLendIcon-{{lendId}}"></i></td>
                  <td><i class="icon-trash" id="deleteLendIcon-{{lendId}}"></i></td>
                </tr>
              {{/lendList}}
              </script>
            </tbody>
          </table>
        </div>
      </div>
      
      <div id="footer"></div>
      
    </div> <!-- /container -->
    
    <!-- Modal Edit -->
    <script id="editLendModalList" type="text/template">
    {{#lendList}}
    <div id="editLendModal-{{lendId}}" class="modal hide fade">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h3>Edit a lend</h3>
      </div>
      <div class="modal-body">
        <form class="form-horizontal" action="#">
          <div class="control-group">
            <label class="control-label" for="inputLendID">ID :</label>
            <div class="controls">
              <input type="text" id="inputWhat" value="{{lendId}}" disabled />
            </div>
          </div>
          <div class="control-group">
            <label class="control-label" for="inputWhat">What :</label>
            <div class="controls">
              <input type="text" id="inputWhat" placeholder="What have you lent ?" value="{{object}}" />
            </div>
          </div>
          <div class="control-group">
            <label class="control-label" for="inputWho">Who :</label>
            <div class="controls">
              <input type="text" id="inputWho" placeholder="To whom you have lent ?" value="{{who}}" />
            </div>
          </div>
          <div class="control-group">
            <label class="control-label" for="inputWhen">When :</label>
            <div class="controls">
              <div data-date-viewmode="years" data-date-format="dd/mm/yyyy" data-date="{{when}}" id="inputWhen" class="datepicker input-append date">
                <input type="text" readonly="" value="{{when}}" size="16" class="span2" />
                <span class="add-on"><i class="icon-calendar"></i></span>
              </div>
            </div>
          </div>
          <br />
        </form>
      </div>
      <div class="modal-footer">
        <button id="cancelEditLendButton" type="button" class="btn" data-dismiss="modal">Close</button>
        <button type="submit" id="editLendButton-{{lendId}}" class="btn btn-primary">Save</button>
      </div>
    </div>
    {{/lendList}}
    </script>
    <!-- /Modal Edit -->
    
    <!-- Modal Delete -->
    <script id="deleteLendModalList" type="text/template">
    {{#lendList}}
      <div id="deleteLendModal-{{lendId}}" class="modal hide fade">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
          <h3>Delete a lend</h3>
        </div>
        <div class="modal-body">
          <p>
             Are you sure to delete this lend ?<br /><br />
             ID : {{lendId}}<br />
             Object : {{object}}<br />
             Who : {{who}}<br />
             When : {{when}}
          </p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn" data-dismiss="modal">Close</button>
          <button type="submit" class="btn btn-danger" id="deleteLendButton-{{lendId}}">Delete</button>
        </div>
      </div>
    {{/lendList}}
    </script>
    <!-- /Modal Delete -->
    
    <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="lib/bootstrap/js/jquery.min.js"></script>
    <script src="lib/bootstrap/js/bootstrap.min.js"></script>
    <script src="lib/bootstrap/datepicker/js/bootstrap-datepicker.js"></script>
    <script src="lib/mustache.js"></script>
    <script>
    $(document).ready(function(){
        
        /*-------------------*/
        // var server = 'http://localhost:8080';
        var server = 'http://lend-it-back.herokuapp.com';
        /*-------------------*/
        
        $('#header').load('header.inc.html');
        $('#footer').load('footer.inc.html');
        
        
        $('#addLendButton').click(function(){
            $('#addLendSuccess').fadeIn();
        });
        $('#editLendButton').click(function(){
            $('#editLendSuccess').fadeIn();
            $('#editLendModal').modal('hide');
        });
        $.getJSON(server + "/services/lends/list?callback=?", function (json) {
        	// Fill templates
            $('#LendListTable').replaceWith(Mustache.to_html($('#LendListTable').html(), json));
            $('#deleteLendModalList').replaceWith(Mustache.to_html($('#deleteLendModalList').html(), json));
            $('#editLendModalList').replaceWith(Mustache.to_html($('#editLendModalList').html(), json));
            
            // DatePicker
            $('.datepicker').datepicker();
            
            // Edit actions
            $('[id^=editLendIcon-]').click(function(){
                var lendId = this.id.substr(this.id.length-1);
                $('#editLendModal-'+lendId).modal();
              });
            $('[id^=editLendButton-]').click(function(){
	            var lendId = this.id.substr(this.id.length-1);
	            $('#editLendModal-'+lendId).modal('hide');
	            // Delete action...
	            $('#editLendSuccess').fadeIn();
	        });
            
            // Delete actions
            $('[id^=deleteLendIcon-]').click(function(){
              var lendId = this.id.substr(this.id.length-1);
              $('#deleteLendModal-'+lendId).modal();
            });
	        $('[id^=deleteLendButton-]').click(function(){
	            var lendId = this.id.substr(this.id.length-1);
	            $('#deleteLendModal-'+lendId).modal('hide');
	            // Delete action...
	            $('#deleteLendSuccess').fadeIn();
	        });
        });
        
    });
    
    </script>
  </body>
</html>
